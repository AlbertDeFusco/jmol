<html>
<head>
<script type="text/javascript" src=Jmol.js></script>
<script type="text/javascript">

function doLoad() {
 document.getElementById("info").reset()
}

function sync() {
 var syncing = document.getElementById("drive").checked
 var s = (syncing ? 'set loglevel 5;sync * on;sync * "set syncMouse"': 'sync * off')
 jmolScript(s, "A");
}


function sync() {
 var syncing = document.getElementById("drive").checked
 if(syncing)
   jmolScript('sync * ON; sync * "set syncMouse on;set syncScript off"','A')
 else
   jmolScript('sync * OFF','A')
}

function encode(cmd, addJS) {
  var s = "<code>"
  if (addJS)s += "jmolScript('"
  s+="<a href='javascript:jmolScript(\"" + cmd.replace(/\"/g,'\\"')+"\",\"A\")'>" + cmd + "</a>"
  if (addJS)s += "', 'A')"
  s+="</code>"
  document.write(s)
}

jmolInitialize(".","JmolApplet.jar")
</script>
</head>
<body onload = doLoad()>

<form id=info>
<input type=checkbox id=drive onClick=sync() accessKey="1">Synchronize
</form>
<table border = 1 cellpadding=10>
<tr>

<td>
<script>jmolApplet(200,"load data/1crn.pdb;cartoon on;color cartoon structure", "A")</script>
<br/>File-derived structure
<br/>
<br/>
<script>

jmolApplet(200,"load data/1crn.pdb;calculate structure;cartoon on;color cartoon structure", "B");
</script>
<br/>Jmol-derived structure
</td>
<td>
<div style="height:500px;overflow:auto">
This page demonstrates a new way to synchronize applets in Jmol. 
The two applets are jmolAppletA and jmolAppletB. Once the checkbox is checked, going to either one controls the other. 

The command used here is simply:
<pre>
<code>
function sync() {
 var syncing = document.getElementById("drive").checked
 if(syncing)
   <script>encode("sync * ON; sync * \"set syncMouse on;set syncScript off\"", 1)</script>
 else
   <script>encode("sync * OFF", 1)</script>
}
</pre>

Note that with this setting, only the user's mouse movements are synchronized. You can still give independent orientation commands to each applet. For example, to jmolAppletA: <script>encode("rotate y 90")</script>. Alternatively, we could have forced the orientations of the two applets to coincide at all times using
<br /><br />
<script>encode("sync * ON; sync * \"set syncMouse off;set syncScript off\";rotate x 0", 1)</script>
<br /><br />
You can also set the syncing so that commands given one applet, such as <script>encode("spin on")</script> or <script>encode("spin off")</script> get sent to the other applet as well, but mouse movements and orientation are not synchronized.


<br /><br />
<script>encode("sync * ON; sync * \"set syncMouse off;set syncScript on\"", 1)</script>
<br /><br />

Now rotate one of the applets with the mouse. Note that they are independent. Still, commands such as <script>encode("spin on")</script> and <script>encode("spin off")</script> sent to one applet are applied to both applets. Setting both syncMouse and syncScript ON allows you to both synchronize mouse movements and synchronize scripting:

<br /><br />
<script>encode("sync * ON; sync * \"set syncMouse on;set syncScript on\"", 1)</script>
<br /><br />

The "*" above means "all applets". We can set the synchronization to be directional using "." to indicate "this applet" and ">" to mean "all other applets". The following code sets the top applet to be the controller and the bottom applet to be the follower with full orientation syncing. 
<br /><br />
<script>encode("sync . ON;sync > SLAVE;sync * \"set syncMouse off;set syncScript off\"", 1)</script>
<br /><br />
If you open a <script>encode("console")</script> on jmolAppletA, you can give commands to the other applet, all applets, or just that applet using something like:

<pre>
<script>encode("sync * ON;sync > \"background white\";sync * OFF")</script>
<script>encode("sync * ON;sync * \"background yellow\";sync * OFF")</script>
<script>encode("sync * ON;sync . \"background black\";sync * OFF")</script>
</pre>
In these examples the indicated commands are sent to jmolAppletA (the top applet) only.
</div>
</td>
</tr>
<tr>
<td colspan=3>
<pre>
Jmol version=11.3.9

# new feature: synchronization of applets using Jmol scripts:
#
# sync .|>|*|appletId[syncId] ON|OFF|SLAVE|command
#
# The sync command allows two or more applets to be synchronized in
# terms of orientation. Move one with the mouse, and the other moves as well.
# In addition, the sync command allows ANY command to be sent to one or more
# other applets directly, without the intervention of JavaScript.
#
# Applets are identified by appletId (jmolApplet0, for instance)
# along with an optional bracketed sync group identifier -- generally a random 
# number that identifies the page containing the controlling applet. If the 
# syncId is not given, then the ID for the page containing the controlling applet
# is used. This feature is important for cross-frame synchronization only. 
#
#
# .          this applet only
# >          all applets except this one
# *          all applets
# appletId   id of a specific applet
# [syncId]   (optional) a unique string of digits -- brackets included
#
# ON         sync as driver (default)
# OFF        turn sync off
# SLAVE      turn sync on, but not as driver
# command    command to send
#
# for example:
#
# sync *   # synchronize all applets as drivers
# sync jmolApplet1  #syncs this applet with jmolApplet1 both as drivers
# sync > "set echo top left;echo OK"  # sends OK to top left of all OTHER applets
# sync jmolApplet2[254678942] OFF  # turns sync off for an applet ON A DIFFERENT PAGE
#                                  # or in a different FRAME
# sync . OFF # turns sync off for this applet
#
# new Jmol.js feature: jmolGetSyncId(); jmolSetSyncId(id);
# allows control over the sync ID via javascript. jmolSetSyncId(id)
# should be called prior to jmolApplet() and should incorporate some sort of
# random digits and no space characters. (A number is good.)
# This should only be necessary for multi-frame pages. 
# -----------------------------------------------------------------------------
</pre>
</td></tr>
</table>


</body>
</html>
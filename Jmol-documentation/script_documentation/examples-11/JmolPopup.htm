<html height="100%">
<head>
<title>Jmol Popup Model</title>
<script type="text/javascript" src="Jmol.js"></script>
<script type="text/javascript">
theScript = document.location.search
function getStateJME() {
	var data = "load inline '" + opener.document.getElementById("JME").jmeFile() + "'"
//data 'model JME'\n" + opener.document.getElementById("JME").jmeFile() + "\nend 'model JME';minimize //addHydrogens"
	return data
}

isJME = (theScript.indexOf("?JME") == 0)
isDRAG = (theScript.indexOf("&DRAG") >= 0)
isSIGNED = (theScript.indexOf("SIGNED") >= 0)
if (isJME)
 theScript = getStateJME()
else if (theScript.indexOf("script=") > 0)
 theScript = unescape(theScript.split("script=")[1].split("&")[0])
else 
 theScript = 0

jmolInitialize(".",isSIGNED)

function refreshModelX(){
	
}

function getState(){
	if (isJME)theScript = getStateJME() 
	if (theScript) {
		return "set loglevel 6;set debugscript;" + theScript + getDragState()
	}
	if (!opener) {
	  alert("The page that opened this pop-up window is not available.")
	  return ""
	}
	return (isJME ? getStateJME() : opener.jmolGetPropertyAsString("stateInfo")) + getDragState() 
}

function doAlert(){
	if (theScript)
		alert("just reload this page to reset the model")
	else
		alert('Click on "refresh model" at any time to see the model in its current state in this window. You may refresh the model as often as desired, and you may resize this model as often as you like.')
}

function getDragState() {
 return ";set picking " + (document.getElementById("chkDrag").checked ? "dragMinimize;" : "identify;")
}

function checkDragMode() {
  jmolScript(getDragState())
}

function getDragCheck() {
 document.write('<label><input type="checkbox" id="chkDrag" onclick="checkDragMode()" ' + (isDRAG ? "checked" : "") + '>drag-minimize mode</label>')

}

</script>

</head>
<body height="100%">
<h3>
 <a href="javascript:jmolScript(getState());checkDragMode()">refresh model</a>
 <a href="javascript:doAlert()">note</a>
</h3>
<script type="text/javascript">
jmolApplet(["100%","85%"],"script javascript:getState()")
</script>
<br/>
<table width=100%><tr><td align=left>
<script type="text/javascript">getDragCheck()</script>
</td><td align=right><a href="javascript:jmolScript('center visible;set zoomlarge false;zoom 90')">recenter model</a>
</td></tr></tab	le>

 </body>
</html>
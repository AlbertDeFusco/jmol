<html>
<head>
<title>Chemene JSDraw/Jmol test</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<script type="text/javascript" src="dojo.xd.js"></script>
<script type="text/javascript" src='../Jmol.js'></script>
<script type="text/javascript" src='Chemene.JSDraw.js'></script>
<script type="text/javascript" src='debug.js'></script>
<script type="text/javascript">

jmolInitialize("..", true) // minimization requires signed applet due to Java getResource bug in FF
var dlg = null
var molfile = null
var script = null
var defaultScript = "set minimizationSteps 25;set antialiasDisplay;set zoomlarge false;set defaultLoadFilter='2D'"

var appletInTable = true


function __jmolLoadMolFile() {
	script = 'set modelKitMode false;zap;data "model molfile"' + molfile + 'end "model molfile";set modelKitMode;'
	jmolScript(script);
}


function showJMol(jsdraw) {
	var smiles = getSmiles();
        molfile = smiles + jsdraw.getMolfile().replace(/\|/,"\n");
	document.getElementById("output").innerHTML = "<pre>" + molfile + "</pre>"
	if (!appletInTable) {
	        if (dlg == null) {
			jmolSetDocument(0)
			var jmolAppletCode = jmolApplet([300,300], defaultScript + ";javascript \"__jmolLoadMolFile()\"")
			dlg = new JsDialog('__jmoldlg', '3D in JMol', jmolAppletCode);
		        dlg.show();
			// applet will be loading at this time
			return;
	        }
	        dlg.show();
	}
	__jmolLoadMolFile()
}

function getSmiles() {
  return document.getElementById("smilesInput").value = JSDraw.get("test").getSmiles()
}

function checkSmiles() {
  ret = "" + jmolEvaluate("'" + JSDraw.get("test").getSmiles() + "'.find('SMARTS', '/noaromatic/' + {*}.find('SMILES'))")
  alert(ret + "\n\n" + (ret.length > 4 ? "OK" : "ERROR!"))
}

function showSmiles() {
  ret = jmolEvaluate("{*}.find('SMILES')")
  alert(ret)
}

function depictSmiles() {
  document.getElementById("smilesInput2").value = jmolEvaluate("{*}.find('SMILES')")
  document.getElementById("frmDepict2").submit()
}

</script>

</head>
<body>

<h2>Chemene JSDraw - Jmol interoperation using Jmol 12.0.RC24</h2>

<p style="width:600px">JSDraw provides custom plug-in architecture.  With the plug-in architecture, you can implement your code with the editor.
This page adds a custom toolbar button to pass the structure on to Jmol to create a 3D structure. (Check the right button on the toolbar)

</p>

<p>We are currently testing this implementation for bugs in JSDraw or Jmol. Please send bug reports to <a href=mailto:hansonr@stolaf.edu>Bob Hanson</a></p>

<table>
<tr>
<td>
<div class='JSDraw' id="test" style="width: 600px; height: 300px;border:1px solid gray" dataformat='molurl' data='data/mol1.mol.txt'></div>
<FORM id="frmDepict1" TARGET="_blank" METHOD="POST" ACTION="http://www.daylight.com/daycgi/depictform">
SMILES: 
<INPUT NAME="smiles" SIZE=50 id="smilesInput">
<INPUT TYPE="button" VALUE="Get" ONCLICK="getSmiles()">
<INPUT TYPE="submit" VALUE="Depict">
</FORM>
</td>
<td>
<script type="text/javascript">
	if (appletInTable) {
		jmolApplet([325,325], defaultScript)
		document.writeln("<br />")
		document.writeln("<a href='javascript:showSmiles()'>Show SMILES</a>")
		document.writeln("<a href='javascript:checkSmiles()'>Compare SMILES</a>")
		document.writeln("<a href='javascript:depictSmiles()'>Depict SMILES</a>")
	}

</script>
</td>
</tr>
</table>

<FORM id="frmDepict2" TARGET="_blank" METHOD="POST" ACTION="http://www.daylight.com/daycgi/depictform">
<input type="hidden" NAME="smiles" SIZE=50 id="smilesInput2">
</FORM>


<div id="output"></div>

<script type="text/javascript">
    JSDraw.create('test', { plugins: [{ iconurl: 'plugins/jmol.gif', tooltips: 'Example Plugin (Show 3D in JMol', onclick: showJMol}] });
</script>

</body>
</html>
